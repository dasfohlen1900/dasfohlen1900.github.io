<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini-Pr√§sentator ‚Äî Mini-Office</title>
<link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#eef4fb;
  --panel:#f8fafc;
  --card:#fff;
  --accent:#0f172a;
  --muted:#6b7280;
  --accent-2:#0366d6;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Work Sans, Roboto, Arial, system-ui;background:linear-gradient(180deg,var(--bg),#fff)}
.app{max-width:1200px;margin:18px auto;padding:12px;display:flex;flex-direction:column;gap:12px}
.header{display:flex;align-items:center;gap:12px;background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 20px rgba(16,24,40,0.06)}
.brand{font-weight:700;font-size:18px;color:var(--accent)}
.toolbar{margin-left:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.btn{background:var(--panel);border:1px solid #e6eef7;padding:8px 10px;border-radius:8px;cursor:pointer}
.btn:active{transform:translateY(1px)}
.container{display:flex;gap:12px;align-items:stretch}
.sidebar{width:220px;background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(16,24,40,0.04);min-height:420px;overflow:auto}
.thumb{background:#fbfdff;border-radius:8px;padding:10px;margin-bottom:10px;cursor:pointer;border:1px solid rgba(15,23,42,0.04);display:flex;flex-direction:column;gap:6px}
.thumb.active{outline:3px solid rgba(3,102,214,0.12);box-shadow:0 6px 14px rgba(3,102,214,0.06)}
.thumb-title{font-weight:600;color:var(--accent);font-size:14px}
.thumb-actions{display:flex;gap:6px;justify-content:flex-end}
.main{flex:1;background:var(--card);padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(16,24,40,0.04);min-height:420px;display:flex;flex-direction:column}
.slide-stage{flex:1;border-radius:8px;background:linear-gradient(180deg,#fff,#fbfdff);padding:12px;overflow:auto;border:1px solid rgba(15,23,42,0.04)}
.slide{width:100%;min-height:320px;padding:28px;border-radius:8px;background:#fff;border:1px dashed rgba(15,23,42,0.06);box-shadow:inset 0 1px 0 rgba(255,255,255,0.6)}
.editor{min-height:260px;outline:none}
.controls{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
.small{padding:6px 8px;font-size:13px}
.footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px;color:var(--muted);font-size:13px}
.note{font-size:13px;color:var(--muted)}
@media (max-width:880px){
  .container{flex-direction:column}
  .sidebar{width:100%;display:flex;flex-direction:row;gap:8px;overflow:auto}
  .thumb{min-width:180px}
}
</style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="brand">üéûÔ∏è Mini-Pr√§sentator</div>
    <div class="toolbar" role="toolbar" aria-label="Hauptwerkzeuge">
      <button class="btn" id="addSlideBtn" title="Neue Folie">‚ûï Neue Folie</button>
      <button class="btn" id="dupSlideBtn" title="Folie duplizieren">‚éò Duplizieren</button>
      <button class="btn" id="delSlideBtn" title="Folie l√∂schen">üóë L√∂schen</button>
      <button class="btn" id="moveLeftBtn" title="Eine Position zur√ºck">‚óÄ</button>
      <button class="btn" id="moveRightBtn" title="Eine Position vor">‚ñ∂</button>
      <button class="btn" id="presentBtn" title="Pr√§sentationsmodus (F5)">‚ñ∂ Pr√§sentieren</button>
      <button class="btn" id="downloadBtn" title="Speichern (.octpt)">üíæ .octpt</button>
      <input id="openFile" type="file" accept=".octpt,.html,.txt" style="display:none" />
      <button class="btn" id="openBtn" title="√ñffnen">üìÇ √ñffnen</button>
      <button class="btn" id="exportHTMLBtn" title="Export HTML">üì§ Export HTML</button>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar" id="thumbnails" aria-label="Foliensortierung">
      <!-- Thumbnails werden hier eingef√ºgt -->
    </aside>

    <main class="main">
      <div class="slide-stage" id="stage" aria-live="polite">
        <div class="slide">
          <div id="editor" class="editor" contenteditable="true" spellcheck="true">
            <h1>Titel</h1>
            <p>Deine erste Folie ‚Äî klicke hier und bearbeite den Text.</p>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="btn small" id="prevBtn">‚¨ÖÔ∏è Vorherige</button>
        <button class="btn small" id="nextBtn">N√§chste ‚û°Ô∏è</button>
        <div style="flex:1"></div>
        <span class="note">Speichert automatisch &nbsp;‚Ä¢&nbsp; Shortcut: Strg+S</span>
      </div>
    </main>
  </div>

  <div class="footer">
    <div>Folien: <span id="count">1</span></div>
    <div class="note">Format: .octpt (HTML-Inhalte der Folien)</div>
  </div>
</div>

<script>
/* Mini-Pr√§sentator ‚Äî single-file app
   - Slides: Array of HTML strings
   - .octpt export/import (JSON array or raw concatenated HTML)
   - Present opens a new window with keyboard navigation
*/

const editor = document.getElementById('editor');
const stage = document.getElementById('stage');
const thumbs = document.getElementById('thumbnails');
const addSlideBtn = document.getElementById('addSlideBtn');
const dupSlideBtn = document.getElementById('dupSlideBtn');
const delSlideBtn = document.getElementById('delSlideBtn');
const moveLeftBtn = document.getElementById('moveLeftBtn');
const moveRightBtn = document.getElementById('moveRightBtn');
const presentBtn = document.getElementById('presentBtn');
const downloadBtn = document.getElementById('downloadBtn');
const openBtn = document.getElementById('openBtn');
const openFile = document.getElementById('openFile');
const exportHTMLBtn = document.getElementById('exportHTMLBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const countEl = document.getElementById('count');

const LS_KEY = 'minipres_v1';
let slides = [];       // array of HTML strings
let current = 0;
let autosaveTimer = null;

/* --- helper: sanitize/trim incoming text --- */
function cleanText(s){
  if(!s) return '';
  return s.replace(/^\uFEFF/,'').replace(/[\u200B\u200C\u200D]/g,'').trim();
}

/* --- initialize with single slide if empty --- */
function ensureSlides(){
  if(!slides || !slides.length){
    slides = [ editor.innerHTML || '<h1>Title</h1><p>Text</p>' ];
    current = 0;
  }
}

/* --- render thumbnails and stage --- */
function render(){
  ensureSlides();
  thumbs.innerHTML = '';
  slides.forEach((html, i) => {
    const t = document.createElement('div');
    t.className = 'thumb' + (i===current ? ' active' : '');
    t.dataset.index = i;
    const title = (stripText(html).split('\n')[0] || `Folie ${i+1}`).slice(0,40);
    t.innerHTML = `<div class="thumb-title">${escapeHtml(title)}</div>
                   <div style="flex:1;margin-top:6px;color:var(--muted);font-size:13px">${trimPreview(html)}</div>
                   <div class="thumb-actions"><button class="small btn" data-action="goto" data-i="${i}">√ñffnen</button></div>`;
    t.addEventListener('click', (e)=> {
      const btn = e.target.closest('button');
      if(btn && btn.dataset.action==='goto'){ selectSlide(parseInt(btn.dataset.i), true); return; }
      selectSlide(i, true);
    });
    thumbs.appendChild(t);
  });

  // update stage
  stage.querySelector('.slide').innerHTML = slides[current];
  countEl.textContent = slides.length;
}

/* strip tags to plain text for title */
function stripText(html){
  const d = document.createElement('div');
  d.innerHTML = html;
  return d.innerText || '';
}
function escapeHtml(text){ const d=document.createElement('div'); d.textContent=text; return d.innerHTML; }
/* small preview from HTML */
function trimPreview(html){
  const txt = stripText(html).replace(/\s+/g,' ').trim();
  return escapeHtml(txt.slice(0,120));
}

/* --- select slide --- */
function selectSlide(i, focus){
  if(i<0||i>=slides.length) return;
  // save current edit first
  saveCurrentFromEditor();
  current = i;
  render();
  if(focus) editor.focus();
}

/* --- save content currently in editor to slides[current] --- */
function saveCurrentFromEditor(){
  const html = cleanText(editor.innerHTML || '');
  slides[current] = html || '<h2>Leer</h2>';
  scheduleAutosave();
}

/* --- add / duplicate / delete / move --- */
function addSlide(afterIndex = null){
  saveCurrentFromEditor();
  const template = '<h2>Neue Folie</h2><p>Inhalt hier...</p>';
  if(afterIndex === null) { slides.push(template); current = slides.length - 1; }
  else { slides.splice(afterIndex+1, 0, template); current = afterIndex+1; }
  render();
  editor.focus();
}
function dupSlide(){
  saveCurrentFromEditor();
  const copy = slides[current] || '';
  slides.splice(current+1,0,copy);
  current = current+1;
  render();
}
function deleteSlide(){
  if(slides.length<=1){ alert('Mindestens eine Folie ist erforderlich.'); return; }
  if(!confirm('Diese Folie wirklich l√∂schen?')) return;
  slides.splice(current,1);
  if(current >= slides.length) current = slides.length -1;
  render();
}
function moveLeft(){
  if(current<=0) return;
  saveCurrentFromEditor();
  const a = slides.splice(current,1)[0];
  slides.splice(current-1,0,a);
  current = current-1;
  render();
}
function moveRight(){
  if(current>=slides.length-1) return;
  saveCurrentFromEditor();
  const a = slides.splice(current,1)[0];
  slides.splice(current+1,0,a);
  current = current+1;
  render();
}

/* --- presenter (open new window) --- */
function openPresenter(){
  saveCurrentFromEditor();
  // build HTML
  const presHTML = `
<!doctype html>
<html>
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pr√§sentation</title>
<style>
  html,body{height:100%;margin:0;background:#000;color:#fff;font-family:Work Sans,Arial}
  .wrap{height:100%;display:flex;align-items:center;justify-content:center;padding:24px}
  .slide{max-width:1100px;width:100%;min-height:60vh;padding:40px;border-radius:8px;background:rgba(255,255,255,0.03)}
  .controls{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:10px}
  button{padding:8px 12px;border-radius:8px;border:none;background:rgba(255,255,255,0.08);color:#fff;cursor:pointer}
  .page{position:fixed;top:10px;right:20px;color:rgba(255,255,255,0.6)}
</style>
</head>
<body>
<div class="wrap"><div class="slide" id="slide"></div></div>
<div class="page" id="page"></div>
<div class="controls">
  <button id="prev">‚¨Ö Vor</button>
  <button id="next">N√§chste ‚û°</button>
  <button id="exit">‚úñ Beenden</button>
</div>
<script>
  const slides = ${JSON.stringify(slides)};
  let idx = 0;
  const slideEl = document.getElementById('slide');
  const page = document.getElementById('page');
  function render(){ slideEl.innerHTML = slides[idx]; page.textContent = (idx+1)+' / '+slides.length; }
  function next(){ idx = Math.min(idx+1, slides.length-1); render(); }
  function prev(){ idx = Math.max(idx-1, 0); render(); }
  document.getElementById('next').addEventListener('click', next);
  document.getElementById('prev').addEventListener('click', prev);
  document.getElementById('exit').addEventListener('click', ()=> window.close());
  document.addEventListener('keydown', (e)=> {
    if(e.key === 'ArrowRight' || e.key==='PageDown') next();
    if(e.key === 'ArrowLeft' || e.key==='PageUp') prev();
    if(e.key === 'Escape') window.close();
  });
  render();
  // focus for keyboard
  window.focus();
</script>
</body>
</html>`;
  const w = window.open('', '_blank', 'toolbar=0,location=0,menubar=0');
  w.document.write(presHTML);
  w.document.close();
}

/* --- export / import (.octpt) --- */
function downloadOctpt(){
  saveCurrentFromEditor();
  // store JSON array as .octpt for robustness
  const blob = new Blob([JSON.stringify(slides)], {type:'application/json;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = (document.title || 'presentation') .replace(/\s+/g,'_') + '.octpt';
  a.click();
  setTimeout(()=>URL.revokeObjectURL(a.href),2000);
}
function importFile(file){
  const r = new FileReader();
  r.onload = ()=> {
    let raw = cleanText(r.result);
    // try JSON array first
    try {
      const parsed = JSON.parse(raw);
      if(Array.isArray(parsed)) {
        slides = parsed.map(s => cleanText(String(s) || ''));
        current = 0;
        render();
        scheduleAutosave();
        return;
      }
    } catch(e){}
    // fallback: split by separator or treat as single HTML
    if(raw.includes('<!--SLIDE-->')){
      slides = raw.split('<!--SLIDE-->').map(s => cleanText(s)).filter(Boolean);
    } else {
      // assume single big HTML -> wrap into one slide
      slides = [ raw ];
    }
    current = 0;
    render();
    scheduleAutosave();
  };
  r.readAsText(file);
}

/* --- export to standalone HTML (slides concatenated) --- */
function exportAsHTML(){
  saveCurrentFromEditor();
  const content = slides.map(s => `<section>${s}</section>`).join('\n<hr/>\n');
  const html = `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Export Pr√§sentation</title>
  <style>body{font-family:Work Sans,Arial;padding:24px} section{max-width:900px;margin:0 auto;padding:40px;border-radius:8px;background:#fff;margin-bottom:20px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}</style>
  </head><body>${content}</body></html>`;
  const blob = new Blob([html], {type:'text/html;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'presentation.html';
  a.click();
  setTimeout(()=>URL.revokeObjectURL(a.href),2000);
}

/* --- autosave to localStorage (debounced) --- */
function scheduleAutosave(){
  clearTimeout(autosaveTimer);
  autosaveTimer = setTimeout(()=>{
    try { localStorage.setItem(LS_KEY, JSON.stringify(slides)); } catch(e){}
  }, 700);
}
/* --- load from localStorage on start --- */
function loadFromLocal(){
  try {
    const raw = localStorage.getItem(LS_KEY);
    if(raw){
      const parsed = JSON.parse(raw);
      if(Array.isArray(parsed) && parsed.length) {
        slides = parsed;
        current = 0;
        render();
        return;
      }
    }
  } catch(e){}
  // default: use current editor content
  slides = [ cleanText(editor.innerHTML) || '<h1>Titel</h1><p>Inhalt</p>' ];
  current = 0;
  render();
}

/* --- interactions --- */
addSlideBtn.addEventListener('click', ()=> addSlide(current));
dupSlideBtn.addEventListener('click', dupSlide);
delSlideBtn.addEventListener('click', deleteSlide);
moveLeftBtn.addEventListener('click', moveLeft);
moveRightBtn.addEventListener('click', moveRight);
presentBtn.addEventListener('click', openPresenter);
downloadBtn.addEventListener('click', downloadOctpt);
openBtn.addEventListener('click', ()=> openFile.click());
openFile.addEventListener('change', (e)=> { if(e.target.files && e.target.files[0]) importFile(e.target.files[0]); openFile.value=''; });
exportHTMLBtn.addEventListener('click', exportAsHTML);
prevBtn.addEventListener('click', ()=> { saveCurrentFromEditor(); selectSlide(Math.max(0, current-1), true); });
nextBtn.addEventListener('click', ()=> { saveCurrentFromEditor(); selectSlide(Math.min(slides.length-1, current+1), true); });

/* when typing in editor, update slide content live */
editor.addEventListener('input', ()=> {
  slides[current] = cleanText(editor.innerHTML);
  scheduleAutosave();
});

/* keyboard shortcuts */
document.addEventListener('keydown', (e)=> {
  const meta = (e.ctrlKey||e.metaKey);
  if(meta && e.key.toLowerCase() === 's'){ e.preventDefault(); downloadOctpt(); return; }
  if(e.key === 'F5'){ e.preventDefault(); openPresenter(); return; }
  if(e.key === 'ArrowRight') { selectSlide(Math.min(slides.length-1, current+1), true); }
  if(e.key === 'ArrowLeft') { selectSlide(Math.max(0, current-1), true); }
});

/* initial load */
loadFromLocal();

/* ensure stage click focuses editor for easy editing */
stage.addEventListener('click', (e)=> {
  // put caret at end of editor
  editor.focus();
  const range = document.createRange();
  range.selectNodeContents(editor);
  range.collapse(false);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
});

</script>
</body>
</html>
