<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mini-Office Anmeldung</title>
<style>
body { font-family: "Segoe UI", sans-serif; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; background:#eef4fb; }
h1 { font-family:'Bungee',cursive; margin-bottom:20px; }
#login { display:flex; flex-direction:column; align-items:center; background:white; padding:30px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,0.2); }
#login button, #login input { padding:10px 20px; margin-top:10px; border-radius:6px; font-family:'Bungee',cursive; font-size:16px; }
#login button { background:#00703C; color:white; border:none; cursor:pointer; }
#login button:hover { background:#005f2b; }
#qrVideo { width:300px; height:300px; border:1px solid #ccc; margin-top:15px; display:none; }
</style>
</head>
<body>
<h1>Mini-Office Anmeldung</h1>

<div id="login">
  <button id="scanCardBtn">Mini-Card scannen</button>
  <input type="text" id="idInput" placeholder="Direkt mit ID anmelden">
  <button id="loginIdBtn">Anmelden mit ID</button>
</div>

<video id="qrVideo" autoplay></video>

<script type="module">
import QrScanner from 'https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.min.js';

const scanCardBtn = document.getElementById('scanCardBtn');
const qrVideo = document.getElementById('qrVideo');
const idInput = document.getElementById('idInput');
const loginIdBtn = document.getElementById('loginIdBtn');

// Alle gültigen IDs (Premium + Gast)
const allowedUsers = [
  {name:'Lukas', id:'008'},
  {name:'Jakob', id:'013'},
  {name:'Moritz', id:'002'},
  {name:'Jakobd', id:'009'},
  {name:'Gast', id:'661'},
  {name:'Gast', id:'662'},
  {name:'Gast', id:'663'}
];

// QR-Scanner starten
scanCardBtn.addEventListener('click', async () => {
    qrVideo.style.display = 'block';
    QrScanner.WORKER_PATH = 'https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner-worker.min.js';
    const scanner = new QrScanner(qrVideo, result => {
        try {
            const data = JSON.parse(result);
            if(data.id && data.name){
                const user = allowedUsers.find(u => u.id===data.id && (u.name===data.name || u.name==='Gast'));
                if(!user){
                    alert("Dieser Benutzer ist nicht erlaubt!");
                    return;
                }
                localStorage.setItem('currentUserId', data.id);
                alert(`${user.name} erfolgreich angemeldet!`);
                window.location.href = '/premium/index.html';
                scanner.stop();
            }
        } catch(e){
            console.log('Ungültiger QR-Code');
        }
    });
    scanner.start();
});

// Anmeldung per ID
loginIdBtn.addEventListener('click', () => {
    const id = idInput.value.trim();
    const user = allowedUsers.find(u => u.id === id);
    if(!user){
        alert("Ungültige ID!");
        return;
    }
    localStorage.setItem('currentUserId', id);
    alert(`${user.name} erfolgreich angemeldet!`);
    window.location.href = '/premium/index.html';
});
</script>
</body>
</html>
