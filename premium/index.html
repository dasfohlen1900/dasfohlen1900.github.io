<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mini-Office Premium Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">
<style>
body { margin:0; padding:0; font-family:"Segoe UI",sans-serif; background:#eef4fb; overflow-x:hidden; }
header { background:#000; color:white; padding:15px 20px; font-family:'Bungee',cursive; font-size:28px; display:flex; justify-content:space-between; align-items:center; }
header .profile { cursor:pointer; font-size:16px; }

#loginForm { display:flex; flex-direction:column; max-width:400px; margin:50px auto; background:white; padding:30px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,0.2); }
#loginForm input { padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ccc; }
#loginForm button { padding:10px; background:#00703C; color:white; border:none; border-radius:6px; cursor:pointer; font-family:'Bungee',cursive; }
#loginForm button:hover { background:#005f2b; }

#dashboard { display:none; display:grid; grid-template-columns: repeat(auto-fill,minmax(120px,1fr)); grid-auto-rows:120px; gap:15px; padding:20px; }
.tile { background:#00703C; color:white; display:flex; justify-content:center; align-items:center; text-align:center; font-family:'Bungee',cursive; font-size:18px; border-radius:12px; cursor:pointer; transition: transform 0.2s, box-shadow 0.2s; }
.tile:hover { transform: scale(1.05); box-shadow:0 8px 20px rgba(0,0,0,0.3); }
.tile[data-size="2x2"] { grid-column: span 2; grid-row: span 2; font-size:22px; }
.tile[data-size="2x1"] { grid-column: span 2; font-size:20px; }

.tile img { width:40px; height:40px; margin-bottom:5px; }

#charmbar { position:fixed; right:-300px; top:0; width:250px; height:100%; background:rgba(0,0,0,0.85); color:white; display:flex; flex-direction:column; padding:20px; transition:right 0.3s ease; z-index:1000; }
#charmbar.show { right:0; }
#charmbar h3 { font-family:'Bungee',cursive; margin-top:0; }
#charmbar button, #charmbar input { margin:8px 0; padding:8px; border:none; border-radius:6px; width:100%; font-size:14px; cursor:pointer; }
#charmbar button:hover { background:#005f2b; }
#closeCharm { align-self:flex-end; margin-bottom:10px; }
</style>
</head>
<body>
<header>
  Mini-Office Dashboard
  <span class="profile">☰</span>
</header>

<form id="loginForm">
  <h2>Anmelden</h2>
  <input type="email" id="email" placeholder="E-Mail-Adresse" required>
  <input type="password" id="password" placeholder="Passwort" required>
  <button type="submit">Anmelden</button>
</form>

<div id="dashboard"></div>

<div id="charmbar">
  <button id="closeCharm">✖</button>
  <h3>Charmbar</h3>
  <label>Suche Mini-Apps:</label>
  <input type="text" id="searchApp" placeholder="Suche...">
  <button onclick="document.getElementById('bgUpload').click()">Hintergrund hochladen</button>
  <input type="file" id="bgUpload" style="display:none">
  <button onclick="setTheme('borussia')">Borussia Farbschema</button>
  <button onclick="setTheme('light')">Hell Farbschema</button>
  <button onclick="setTheme('dark')">Dark Mode</button>
  <button onclick="shareLink()">Teilen</button>
  <button onclick="showInfo()">Info</button>
  <button onclick="logout()">Abmelden</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyC4vkDRFGgoHZ8lyGY8VeYYtP6oA-PqaNs",
  authDomain: "lukovic-store.firebaseapp.com",
  projectId: "lukovic-store",
  storageBucket: "lukovic-store.firebasestorage.app",
  messagingSenderId: "519122370011",
  appId: "1:519122370011:web:d7bc0ec5cb066d4f033bfe"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

document.addEventListener('DOMContentLoaded', () => {
  const loginForm = document.getElementById('loginForm');
  const dashboard = document.getElementById('dashboard');
  const charmbar = document.getElementById('charmbar');
  const profileBtn = document.querySelector('.profile');
  const closeCharmBtn = document.getElementById('closeCharm');

  const tilesData = [
    {name:"Mini-Word", size:"2x2", url:"https://dasfohlen1900.github.io/mini-word", icon:"https://cdn-icons-png.flaticon.com/512/337/337946.png"},
    {name:"Mini-Calc", size:"1x1", url:"https://dasfohlen1900.github.io/mini-calc", icon:"https://cdn-icons-png.flaticon.com/512/992/992651.png"},
    {name:"Der Mini-Kicker", size:"1x1", url:"https://dasfohlen1900.github.io/derminikicker", icon:"https://cdn-icons-png.flaticon.com/512/684/684908.png"},
    {name:"Mini-Präsentator", size:"2x1", url:"https://dasfohlen1900.github.io/mini-pp", icon:"https://cdn-icons-png.flaticon.com/512/716/716784.png"},
    {name:"2048", size:"1x1", url:"https://dasfohlen1900.github.io/games/2048", icon:"https://cdn-icons-png.flaticon.com/512/2910/2910766.png"},
    {name:"Mini-Draw", size:"1x1", url:"https://dasfohlen1900.github.io/mini-draw", icon:"https://cdn-icons-png.flaticon.com/512/2920/2920332.png"},
    {name:"Store", size:"2x1", url:"https://dasfohlen1900.github.io/store", icon:"https://cdn-icons-png.flaticon.com/512/263/263142.png"},
    {name:"Konsole (DEV\\)", size:"1x1", url:"https://dasfohlen1900.github.io/console", icon:"https://cdn-icons-png.flaticon.com/512/3059/3059987.png"},
    {name:"Mini-Tafel", size:"2x2", url:"https://dasfohlen1900.github.io/mini-notes", icon:"https://cdn-icons-png.flaticon.com/512/254/254034.png"}
  ];

  function saveLayout(){
    const layout = Array.from(dashboard.querySelectorAll('.tile')).map(t=>t.innerText);
    localStorage.setItem('dashboard_'+auth.currentUser.uid, JSON.stringify(layout));
  }

  function loadLayout(){
    if(auth.currentUser){
      const layout = JSON.parse(localStorage.getItem('dashboard_'+auth.currentUser.uid) || 'null');
      if(layout){
        const orderedTiles = [];
        layout.forEach(name=>{
          const t = tilesData.find(td=>td.name===name);
          if(t) orderedTiles.push(t);
        });
        tilesData.forEach(td=>{ if(!orderedTiles.includes(td)) orderedTiles.push(td); });
        tilesData.splice(0, tilesData.length, ...orderedTiles);
      }
    }
  }

  function renderTiles(){
    dashboard.innerHTML="";
    tilesData.forEach((t,i)=>{
      const div=document.createElement('div');
      div.className='tile';
      div.dataset.size=t.size;
      div.draggable=true;
      div.innerHTML = `<div style="display:flex; flex-direction:column; align-items:center; justify-content:center;">
                          <img src="${t.icon}" alt="${t.name}">
                          <span>${t.name}</span>
                       </div>`;
      div.onclick=()=>{ if(t.url) window.open(t.url,'_blank'); else alert('Link fehlt!'); };
      div.addEventListener('dragstart', e=>{ e.dataTransfer.setData('text/plain',i); });
      div.addEventListener('dragover', e=>e.preventDefault());
      div.addEventListener('drop', e=>{
        e.preventDefault();
        const fromIndex = e.dataTransfer.getData('text/plain');
        tilesData.splice(i,0,tilesData.splice(fromIndex,1)[0]);
        renderTiles();
        saveLayout();
      });
      dashboard.appendChild(div);
    });
  }

  loginForm.addEventListener('submit', e=>{
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    signInWithEmailAndPassword(auth,email,password)
      .then(()=>{ 
        loginForm.style.display='none'; 
        dashboard.style.display='grid'; 
        loadLayout();
        renderTiles(); 
      })
      .catch(err=>alert("Login fehlgeschlagen: "+err.message));
  });

  profileBtn.addEventListener('click', ()=>{ charmbar.classList.toggle('show'); });
  closeCharmBtn.addEventListener('click', ()=>{ charmbar.classList.remove('show'); });

  document.getElementById('searchApp').addEventListener('input', ()=>{
    const term = document.getElementById('searchApp').value.toLowerCase();
    dashboard.querySelectorAll('.tile').forEach(t=>{
      t.style.display = t.innerText.toLowerCase().includes(term) ? 'flex' : 'none';
    });
  });

  document.getElementById('bgUpload').addEventListener('change', e=>{
    const file = e.target.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = function(evt){
        document.body.style.backgroundImage = `url(${evt.target.result})`;
        document.body.style.backgroundSize="cover";
        document.body.style.backgroundRepeat="no-repeat";
        document.body.style.backgroundPosition="center center";
      };
      reader.readAsDataURL(file);
    }
  });

  window.setTheme = (theme)=>{
    if(theme==='borussia'){ 
      document.body.style.background="#eef4fb";
      dashboard.querySelectorAll('.tile').forEach(t=>{t.style.background="#00703C"; t.style.color="white";});
    } else if(theme==='dark'){
      document.body.style.background="#121212";
      dashboard.querySelectorAll('.tile').forEach(t=>{t.style.background="#1e1e1e"; t.style.color="white";});
    } else {
      document.body.style.background="#f5f5f5";
      dashboard.querySelectorAll('.tile').forEach(t=>{t.style.background="#ccc"; t.style.color="black";});
    }
  };

  window.shareLink = ()=>{ prompt("Teile diesen Link:", window.location.href); };
  window.showInfo = ()=>{ alert("Mini-Office Premium Dashboard\nVersion 1.0"); };
  window.logout = ()=>{ signOut(auth).then(()=>{ location.reload(); }); };

  onAuthStateChanged(auth, user=>{
    if(user){ loginForm.style.display='none'; dashboard.style.display='grid'; loadLayout(); renderTiles(); }
    else{ loginForm.style.display='flex'; dashboard.style.display='none'; }
  });
});
</script>
</body>
</html>
