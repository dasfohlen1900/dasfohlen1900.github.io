<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mini-Office Premium Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet">
<style>
body { margin:0; padding:0; font-family:"Segoe UI",sans-serif; background:#eef4fb; overflow-x:hidden; transition: background 0.3s; }
body.dark { background:#1e1e1e; color:#eee; }
header { background:#000; color:white; padding:15px 20px; font-family:'Bungee',cursive; font-size:28px; display:flex; justify-content:space-between; align-items:center; }
header .profile { cursor:pointer; font-size:16px; }

#dashboard { display:grid; grid-template-columns: repeat(auto-fill,minmax(120px,1fr)); grid-auto-rows:120px; gap:15px; padding:20px; }
.tile { background:#00703C; color:white; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; font-family:'Bungee',cursive; font-size:18px; border-radius:12px; cursor:pointer; transition: transform 0.2s, box-shadow 0.2s; }
body.dark .tile { background:#444; color:#eee; }
.tile img { width:48px; height:48px; margin-bottom:5px; }
.tile:hover { transform: scale(1.05); box-shadow:0 8px 20px rgba(0,0,0,0.3); }
.tile[data-size="2x2"] { grid-column: span 2; grid-row: span 2; font-size:22px; }
.tile[data-size="2x1"] { grid-column: span 2; font-size:20px; }
.tile[data-size="1x2"] { grid-row: span 2; }

#charmbar { position:fixed; right:-300px; top:0; width:250px; height:100%; background:rgba(0,0,0,0.85); color:white; display:flex; flex-direction:column; padding:20px; transition:right 0.3s ease; z-index:1000; }
#charmbar.show { right:0; }
#charmbar h3 { font-family:'Bungee',cursive; margin-top:0; }
#charmbar button, #charmbar input { margin:8px 0; padding:8px; border:none; border-radius:6px; width:100%; font-size:14px; cursor:pointer; }
#charmbar button:hover { background:#005f2b; }
#closeCharm { align-self:flex-end; margin-bottom:10px; }
</style>
</head>
<body>
<header>
  Mini-Office Dashboard
  <span class="profile">☰</span>
</header>

<div id="dashboard"></div>

<div id="charmbar">
  <button id="closeCharm">✖</button>
  <h3>Charmbar</h3>
  <label>Suche Mini-Apps:</label>
  <input type="text" id="searchApp" placeholder="Suche...">
  <button onclick="document.getElementById('bgUpload').click()">Hintergrund hochladen</button>
  <input type="file" id="bgUpload" style="display:none">
  <button onclick="setTheme('borussia')">Borussia Farbschema</button>
  <button onclick="setTheme('light')">Hell Farbschema</button>
  <button onclick="setTheme('dark')">Dark Mode</button>
  <button onclick="shareLink()">Teilen</button>
  <button onclick="showInfo()">Info</button>
  <button onclick="logout()">Abmelden</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const dashboard = document.getElementById('dashboard');
  const charmbar = document.getElementById('charmbar');
  const profileBtn = document.querySelector('.profile');
  const closeCharmBtn = document.getElementById('closeCharm');

  // --------------------------
  // Premium-Schutz
  // --------------------------
  const userId = localStorage.getItem('currentUserId');
  if(!userId){
      window.location.href = '/premium/auth.html';
      return;
  }

  // --------------------------
  // Tiles Daten
  // --------------------------
  const tilesData = [
    {name:"Mini-Word", size:"2x2", url:"https://dasfohlen1900.github.io/mini-word", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/file-text.svg"},
    {name:"Mini-Calc", size:"1x1", url:"https://dasfohlen1900.github.io/mini-calc", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/calculator.svg"},
    {name:"Der Mini-Kicker", size:"1x1", url:"https://dasfohlen1900.github.io/derminikicker", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/activity.svg"},
    {name:"Mini-Präsentator", size:"2x1", url:"https://dasfohlen1900.github.io/mini-pp", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/slideshow.svg"},
    {name:"2048", size:"1x1", url:"https://dasfohlen1900.github.io/games/2048", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/grid.svg"},
    {name:"Mini-Draw", size:"1x1", url:"https://dasfohlen1900.github.io/mini-draw", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/edit-2.svg"},
    {name:"Store", size:"2x1", url:"https://dasfohlen1900.github.io/store", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/shopping-cart.svg"},
    {name:"Konsole (DEV)", size:"1x1", url:"https://dasfohlen1900.github.io/console", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/terminal.svg"},
    {name:"Mini-Tafel", size:"2x2", url:"https://dasfohlen1900.github.io/mini-notes", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/clipboard.svg"},
    {name:"Mini-Table", size:"1x2", url:"https://dasfohlen1900.github.io/mini-table", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/grid.svg"},
    {name:"Mini-Randomizer", size:"1x1", url:"https://dasfohlen1900.github.io/premium/randomizer", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/shuffle.svg"},
    {name:"Penalty", size:"1x1", url:"https://dasfohlen1900.github.io/games/penalty", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/award.svg"},
    {name:"Mini-Uhr", size:"2x2", url:"https://dasfohlen1900.github.io/mini-uhr", icon:"https://cdn.jsdelivr.net/gh/feathericons/feather/icons/clock.svg"}
  ];

  // --------------------------
  // Layout speichern/laden
  // --------------------------
  function saveLayout(){
      const layout = Array.from(dashboard.querySelectorAll('.tile')).map(t=>t.dataset.name);
      localStorage.setItem('dashboard_'+userId, JSON.stringify(layout));
  }

  function loadLayout(){
      const layout = JSON.parse(localStorage.getItem('dashboard_'+userId) || 'null');
      if(layout){
        const orderedTiles = [];
        layout.forEach(name=>{ const t = tilesData.find(td=>td.name===name); if(t) orderedTiles.push(t); });
        tilesData.forEach(td=>{ if(!orderedTiles.includes(td)) orderedTiles.push(td); });
        tilesData.splice(0, tilesData.length, ...orderedTiles);
      }
  }

  // --------------------------
  // Dashboard rendern
  // --------------------------
  function renderTiles(){
    dashboard.innerHTML="";
    tilesData.forEach((t,i)=>{
      const div=document.createElement('div');
      div.className='tile';
      div.dataset.size=t.size;
      div.dataset.name=t.name;
      div.innerHTML=`<img src="${t.icon}" alt="${t.name} Icon"><br>${t.name}`;
      div.draggable=true;
      div.onclick=()=>{ if(t.url) window.open(t.url,'_blank'); else alert('Link fehlt!'); };
      div.addEventListener('dragstart', e=>{ e.dataTransfer.setData('text/plain',i); });
      div.addEventListener('dragover', e=>e.preventDefault());
      div.addEventListener('drop', e=>{
        e.preventDefault();
        const fromIndex = e.dataTransfer.getData('text/plain');
        tilesData.splice(i,0,tilesData.splice(fromIndex,1)[0]);
        renderTiles();
        saveLayout();
      });
      dashboard.appendChild(div);
    });
  }

  // --------------------------
  // Charmbar & Funktionen
  // --------------------------
  profileBtn.addEventListener('click', ()=>{ charmbar.classList.toggle('show'); });
  closeCharmBtn.addEventListener('click', ()=>{ charmbar.classList.remove('show'); });

  document.getElementById('searchApp').addEventListener('input', ()=>{
    const term = document.getElementById('searchApp').value.toLowerCase();
    dashboard.querySelectorAll('.tile').forEach(t=>{
      t.style.display = t.innerText.toLowerCase().includes(term) ? 'flex' : 'none';
    });
  });

  document.getElementById('bgUpload').addEventListener('change', e=>{
    const file = e.target.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = function(evt){
        document.body.style.backgroundImage = `url(${evt.target.result})`;
        document.body.style.backgroundSize="cover";
        document.body.style.backgroundRepeat="no-repeat";
        document.body.style.backgroundPosition="center center";
      };
      reader.readAsDataURL(file);
    }
  });

  window.setTheme = (theme)=>{
    document.body.classList.remove('dark');
    if(theme==='borussia'){
      document.body.style.background="#eef4fb";
      dashboard.querySelectorAll('.tile').forEach(t=>t.style.background="#00703C");
    } else if(theme==='light'){
      document.body.style.background="#f5f5f5";
      dashboard.querySelectorAll('.tile').forEach(t=>t.style.background="#666");
    } else if(theme==='dark'){
      document.body.classList.add('dark');
    }
  };

  window.shareLink = ()=>{ prompt("Teile diesen Link:", window.location.href); };
  window.showInfo = ()=>{ alert("Mini-Office Premium Dashboard\nVersion 1.0"); };
  window.logout = ()=>{ localStorage.removeItem('currentUserId'); location.href='/premium/auth.html'; };

  // --------------------------
  // Init
  // --------------------------
  loadLayout();
  renderTiles();
});
</script>
</body>
</html>
