<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Font-Zeichenanzeige (nur vorhandene Glyphen)</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }
  h1 { font-size: 1.5em; }
  #output {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  .char {
    background: white;
    border: 1px solid #ccc;
    padding: 10px;
    width: 80px;
    height: 100px;
    text-align: center;
    font-size: 32px;
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .code {
    font-family: monospace;
    font-size: 12px;
    color: #555;
    margin-top: 6px;
  }
</style>
</head>
<body>
<h1>Font-Zeichenanzeige</h1>
<p><input type="file" id="fontInput" accept=".ttf,.otf,.woff,.woff2"></p>
<div id="output"></div>

<script>
const fontInput = document.getElementById("fontInput");
const output = document.getElementById("output");

fontInput.addEventListener("change", async () => {
  const file = fontInput.files[0];
  if (!file) return;

  const blobURL = URL.createObjectURL(file);
  const fontName = "uploadedFont_" + Math.random().toString(36).slice(2);

  const style = document.createElement("style");
  style.textContent = `
    @font-face {
      font-family: '${fontName}';
      src: url('${blobURL}');
    }
  `;
  document.head.appendChild(style);

  await document.fonts.load(`40px ${fontName}`);
  output.innerHTML = `<p><b>Font geladen:</b> ${file.name}</p>`;

  const canvas = document.createElement("canvas");
  canvas.width = 80;
  canvas.height = 80;
  const ctx = canvas.getContext("2d");

  // Referenzbild mit leeren oder Fallback-Glyphen
  function renderGlyph(font, char) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.font = `60px ${font}`;
    ctx.textBaseline = "middle";
    ctx.fillStyle = "black";
    ctx.fillText(char, 10, 40);
    return ctx.getImageData(0, 0, canvas.width, canvas.height).data;
  }

  function isDifferent(a, b) {
    for (let i = 0; i < a.length; i += 4) {
      if (a[i] !== b[i] || a[i + 1] !== b[i + 1] || a[i + 2] !== b[i + 2]) {
        return true;
      }
    }
    return false;
  }

  const refData = renderGlyph("monospace", "â–¯"); // Platzhalter als Referenz

  for (let i = 32; i <= 0xFFFF; i++) {
    const char = String.fromCharCode(i);
    const data = renderGlyph(fontName, char);
    if (isDifferent(refData, data)) {
      const div = document.createElement("div");
      div.className = "char";
      div.style.fontFamily = fontName;
      div.innerHTML = `
        <div>${char}</div>
        <div class="code">U+${i.toString(16).toUpperCase().padStart(4,"0")}</div>
      `;
      output.appendChild(div);
    }
  }
});
</script>
</body>
</html>
