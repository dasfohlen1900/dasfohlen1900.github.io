<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>Mini-Draw 1.2</title>
<style>
  body{margin:0;background:#f3f4f6;font-family:'Segoe UI',sans-serif;
       display:flex;justify-content:center;padding:40px 0;}
  .paper{background:#fff;width:820px;min-height:1000px;box-shadow:0 0 20px rgba(0,0,0,.1);
         padding:30px;border-radius:16px;display:flex;flex-direction:column;align-items:center;}
  h1{margin-top:0;font-size:28px;}
  .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:15px;justify-content:center;}
  button,select,input[type=color]{padding:6px 10px;font-size:15px;border:none;border-radius:6px;background:#e5e7eb;cursor:pointer;}
  button:hover,select:hover,input[type=color]:hover{background:#d1d5db;}
  .active{background:#93c5fd !important;}
  canvas{border:1px solid #ccc;border-radius:8px;cursor:crosshair;background:#fff;}
  input[type=file]{display:none;}
</style>
</head>
<body>
<div class="paper">
  <h1>Mini-Draw</h1>

  <div class="toolbar">
    <label>Farbe:
      <input type="color" id="color" value="#000000">
    </label>
    <select id="size">
      <option value="2">2 px</option>
      <option value="4">4 px</option>
      <option value="6" selected>6 px</option>
      <option value="10">10 px</option>
      <option value="20">20 px</option>
    </select>
    <button id="penBtn" class="active" onclick="setMode('pen')">✏️ Stift</button>
    <button id="eraserBtn" onclick="setMode('eraser')">🩹 Radierer</button>
    <button onclick="clearCanvas()">🧹 Löschen</button>
    <button onclick="saveDrawing()">💾 Speichern (.octdr)</button>
    <button onclick="loadInput.click()">📂 Laden (.octdr)</button>
    <button onclick="imgInput.click()">🖼️ Bild einfügen</button>
    <input id="loadInput" type="file" accept=".octdr" onchange="loadDrawing(this.files)">
    <input id="imgInput" type="file" accept="image/*" onchange="insertImage(this.files)">
  </div>

  <canvas id="canvas" width="760" height="500"></canvas>
</div>

<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const penBtn=document.getElementById('penBtn');
const eraserBtn=document.getElementById('eraserBtn');
let mode='pen', drawing=false, strokes=[], currentStroke=[];

function setMode(m){
  mode=m;
  penBtn.classList.toggle('active',m==='pen');
  eraserBtn.classList.toggle('active',m==='eraser');
}

function start(e){
  drawing=true;
  const col = mode==='eraser' ? '#ffffff' : color.value;
  const wid = size.value;
  currentStroke=[{x:e.offsetX,y:e.offsetY,c:col,w:wid}];
}
function draw(e){
  if(!drawing)return;
  const col = mode==='eraser' ? '#ffffff' : color.value;
  const wid = size.value;
  ctx.strokeStyle=col;
  ctx.lineWidth=wid;
  ctx.lineCap='round';
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
  currentStroke.push({x:e.offsetX,y:e.offsetY,c:col,w:wid});
}
function end(){
  if(!drawing)return;
  drawing=false;
  ctx.beginPath();
  if(currentStroke.length>1){strokes.push(currentStroke);}
  currentStroke=[];
}

canvas.addEventListener('mousedown',start);
canvas.addEventListener('mousemove',draw);
canvas.addEventListener('mouseup',end);
canvas.addEventListener('mouseleave',end);

function redraw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  strokes.forEach(s=>{
    ctx.beginPath();
    for(let i=0;i<s.length;i++){
      const p=s[i];
      ctx.strokeStyle=p.c;
      ctx.lineWidth=p.w;
      ctx.lineCap='round';
      if(i===0) ctx.moveTo(p.x,p.y);
      else ctx.lineTo(p.x,p.y);
    }
    ctx.stroke();
  });
  ctx.beginPath();
}

function clearCanvas(){
  strokes=[];
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

function saveDrawing(){
  const blob=new Blob([JSON.stringify({createdAt:new Date().toISOString(),strokes},null,2)],
                      {type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='drawing.octdr';
  a.click();
  setTimeout(()=>URL.revokeObjectURL(a.href),2000);
}

function loadDrawing(files){
  const f=files[0]; if(!f) return;
  const reader=new FileReader();
  reader.onload=e=>{
    try{
      const o=JSON.parse(e.target.result);
      if(o.strokes){strokes=o.strokes;redraw();}
    }catch{alert('Ungültige Datei');}
  };
  reader.readAsText(f);
}

function insertImage(files){
  const f=files[0]; if(!f)return;
  const img=new Image();
  img.onload=()=>{
    ctx.drawImage(img,0,0,canvas.width,canvas.height);
    // als eigener Stroke speichern (Hintergrundbild)
    strokes.push([{img:canvas.toDataURL()}]);
  };
  img.src=URL.createObjectURL(f);
}
</script>
</body>
</html>

