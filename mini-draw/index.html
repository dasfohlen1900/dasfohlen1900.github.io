<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Mini-Draw</title>
<style>
body{margin:0;font-family:Segoe UI,Arial,sans-serif;display:flex;flex-direction:column;align-items:center;background:#eef4fb;padding:10px;}
header{display:flex;flex-wrap:wrap;gap:6px;align-items:center;margin-bottom:8px;}
canvas{border:1px solid #aaa;border-radius:8px;background:#fff;touch-action:none;}
button,input,select{padding:6px 10px;border-radius:6px;border:1px solid #ccc;background:#f8fafc;cursor:pointer;}
.color{width:36px;height:36px;padding:0;}
</style>
</head>
<body>
<header>
  <button id="drawMode">✏️ Zeichnen</button>
  <button id="textMode">🔤 Text</button>
  <input type="color" id="color" class="color" value="#000000">
  <select id="size">
    <option value="20">20px</option>
    <option value="30" selected>30px</option>
    <option value="40">40px</option>
    <option value="60">60px</option>
  </select>
  <button id="saveImg">💾 PNG</button>
  <button id="saveOct">💾 .octdr</button>
  <input type="file" id="openOct" style="display:none;">
  <button id="openBtn">📂 Öffnen</button>
</header>

<canvas id="canvas" width="800" height="500"></canvas>

<script>
const c=document.getElementById('canvas');
const ctx=c.getContext('2d');
ctx.fillStyle='#fff';ctx.fillRect(0,0,c.width,c.height);

let drawing=false, mode='draw', texts=[], currentColor=document.getElementById('color').value;

function start(e){
  if(mode!=='draw') return;
  drawing=true;draw(e);
}
function end(){drawing=false;ctx.beginPath();}
function draw(e){
  if(!drawing) return;
  const r=c.getBoundingClientRect();
  const x=(e.clientX||e.touches[0].clientX)-r.left;
  const y=(e.clientY||e.touches[0].clientY)-r.top;
  ctx.strokeStyle=currentColor;
  ctx.lineWidth=2;
  ctx.lineCap='round';
  ctx.lineTo(x,y);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(x,y);
}
c.addEventListener('mousedown',start);
c.addEventListener('touchstart',start);
c.addEventListener('mouseup',end);
c.addEventListener('touchend',end);
c.addEventListener('mousemove',draw);
c.addEventListener('touchmove',draw);

document.getElementById('drawMode').onclick=()=>mode='draw';
document.getElementById('textMode').onclick=()=>mode='text';
document.getElementById('color').oninput=e=>currentColor=e.target.value;

c.addEventListener('click',e=>{
  if(mode!=='text') return;
  const text=prompt("Text eingeben:");
  if(!text) return;
  const fontSize=document.getElementById('size').value;
  ctx.fillStyle=currentColor;
  ctx.font=`${fontSize} Signika,Arial,sans-serif`;
  const r=c.getBoundingClientRect();
  const x=e.clientX-r.left;
  const y=e.clientY-r.top;
  ctx.fillText(text,x,y);
  texts.push({x,y,font:ctx.font,color:currentColor,text});
});

// PNG speichern
document.getElementById('saveImg').onclick=()=>{
  const a=document.createElement('a');
  a.download='mini-draw.png';
  a.href=c.toDataURL();
  a.click();
};

// OCTDR speichern
document.getElementById('saveOct').onclick=()=>{
  const img=c.toDataURL();
  const data={
    type:'octdr',
    version:1,
    width:c.width,
    height:c.height,
    background:'#ffffff',
    image:img,
    texts
  };
  const blob=new Blob([JSON.stringify(data)],{type:'text/plain'});
  const a=document.createElement('a');
  a.download='drawing.octdr';
  a.href=URL.createObjectURL(blob);
  a.click();
};

// OCTDR öffnen
document.getElementById('openBtn').onclick=()=>document.getElementById('openOct').click();
document.getElementById('openOct').onchange=e=>{
  const file=e.target.files[0];
  if(!file) return;
  const r=new FileReader();
  r.onload=()=>{
    const obj=JSON.parse(r.result);
    const img=new Image();
    img.onload=()=>{
      ctx.clearRect(0,0,c.width,c.height);
      ctx.drawImage(img,0,0,c.width,c.height);
      texts=obj.texts||[];
    };
    img.src=obj.image;
  };
  r.readAsText(file);
};
</script>
</body>
</html>
