<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Mini-Word Pro 💚</title>
  <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Carlito&family=Lilita+One&family=Signika&family=Roboto&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 0;
    }
    #toolbar {
      background-color: #008000;
      padding: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    #toolbar button {
      background-color: #ffffff;
      border: none;
      padding: 6px 12px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 4px;
    }
    #toolbar button:hover {
      background-color: #00cc66;
      color: white;
    }
    .tab-panel {
      display: none;
      padding: 10px;
      background-color: #e0e0e0;
      border-bottom: 2px solid #008000;
    }
    #editor {
      margin: 10px;
      padding: 10px;
      min-height: 300px;
      background-color: white;
      border: 2px solid #008000;
    }
    select, input[type="number"], input[type="color"] {
      margin-right: 6px;
    }
    img {
      max-width: 100%;
      margin: 5px 0;
    }
  </style>
</head>
<body>

  <div id="toolbar">
    <button onclick="showTab('datei')">📁 Datei</button>
    <button onclick="showTab('text')">🔤 Text</button>
    <button onclick="showTab('einfügen')">🖼️ Einfügen</button>
    <button onclick="showTab('ausrichtung')">📐 Ausrichtung</button>
    <button onclick="showTab('extras')">🧠 Extras</button>
  </div>

  <div id="tab-content">
    <div id="datei" class="tab-panel">
      <button onclick="printDoc()">🖨️ Drucken</button>
      <button onclick="loadDoc()">📂 Laden</button>
      <button onclick="saveDoc()">💾 Speichern</button>
      <input type="file" accept=".minidoc,.octxt" onchange="handleImport(this.files[0])">
      <button onclick="exportMinidoc()">⬇️ Export .minidoc</button>
      <button onclick="exportOctxt()">⬇️ Export .octxt</button>
    </div>

    <div id="text" class="tab-panel">
      <select onchange="setFont(this.value)">
        <option>Arial</option><option>Courier</option><option>Georgia</option>
        <option>Segoe UI</option><option>Times</option><option>Verdana</option>
        <option>Bungee</option><option>Carlito</option><option>Lilita One</option>
        <option>Signika</option><option>Roboto</option>
      </select>
      <input type="number" min="8" max="72" onchange="setFontSize(this.value)" placeholder="Größe">
      <input type="color" onchange="setColor(this.value)">
      <button onclick="format('bold')">B</button>
      <button onclick="format('italic')">I</button>
      <button onclick="format('underline')">U</button>
      <button onclick="format('strikeThrough')">S</button>
      <button onclick="format('formatBlock','<h1>')">H1</button>
    </div>

    <div id="einfügen" class="tab-panel">
      <button onclick="insertImage()">🌐 Bild-URL</button>
      <input type="file" accept="image/*" onchange="insertLocalImage(this.files[0])">
      <button onclick="insertSymbol()">Ω Sonderzeichen</button>
    </div>

    <div id="ausrichtung" class="tab-panel">
      <button onclick="format('justifyLeft')">⬅️ Links</button>
      <button onclick="format('justifyCenter')">↔️ Mitte</button>
      <button onclick="format('justifyRight')">➡️ Rechts</button>
      <button onclick="format('insertOrderedList')">1️⃣ Nummerierung</button>
      <button onclick="format('insertUnorderedList')">🔘 Aufzählung</button>
    </div>

    <div id="extras" class="tab-panel">
      <button onclick="checkSpelling()">🧠 Rechtschreibung</button>
    </div>
  </div>

  <div id="editor" contenteditable="true">
    Willkommen bei Mini-Word Pro 💚
  </div>

  <script>
    function showTab(tabId) {
      document.querySelectorAll(".tab-panel").forEach(p => p.style.display = "none");
      document.getElementById(tabId).style.display = "block";
    }

    function format(command, value = null) {
      document.execCommand(command, false, value);
    }

    function setFont(font) {
      document.execCommand("fontName", false, font);
      document.getElementById("editor").style.fontFamily = font;
    }

    function setFontSize(size) {
      document.execCommand("fontSize", false, "7");
      let fontElements = document.getElementById("editor").getElementsByTagName("font");
      for (let i = 0; i < fontElements.length; i++) {
        if (fontElements[i].size == "7") {
          fontElements[i].removeAttribute("size");
          fontElements[i].style.fontSize = size + "px";
        }
      }
    }

    function setColor(color) {
      document.execCommand("foreColor", false, color);
    }

    function insertImage() {
      let url = prompt("Bild-URL eingeben:");
      if (url) document.execCommand("insertImage", false, url);
    }

    function insertLocalImage(file) {
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = document.createElement("img");
        img.src = e.target.result;
        document.getElementById("editor").appendChild(img);
      };
      reader.readAsDataURL(file);
    }

    function insertSymbol() {
      let symbol = prompt("Sonderzeichen eingeben (z. B. ©, Ω, ∞):");
      if (symbol) document.execCommand("insertText", false, symbol);
    }

    function printDoc() {
      window.print();
    }

    function saveDoc() {
      localStorage.setItem("miniWordContent", document.getElementById("editor").innerHTML);
      alert("Dokument gespeichert!");
    }

    function loadDoc() {
      let content = localStorage.getItem("miniWordContent");
      if (content) document.getElementById("editor").innerHTML = content;
      else alert("Kein gespeichertes Dokument gefunden.");
    }

    function exportMinidoc() {
      const doc = {
        meta: {
          title: "Mein Dokument",
          font: document.getElementById("editor").style.fontFamily || "Roboto",
          size: window.getComputedStyle(editor).fontSize,
          color: window.getComputedStyle(editor).color,
          timestamp: new Date().toISOString()
        },
        content: document.getElementById("editor").innerHTML
      };
      const blob = new Blob([JSON.stringify(doc, null, 2)], { type: "application/json" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "dokument.minidoc";
      link.click();
    }

    function exportOctxt() {
      const text = document.getElementById("editor").innerText;
      const branding = "🐙 Mini-Word Pro – Oktopus Edition 🐙\n------------------------------------\n";
      const blob = new Blob([branding + text], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "dokument.octxt";
      link.click();
    }

    function handleImport(file) {
      if (file.name.endsWith(".minidoc")) importMinidoc(file);
      else if (file.name.endsWith(".octxt")) importOctxt(file);
      else alert("Unbekanntes Format!");
    }
    function importMinidoc(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const doc = JSON.parse(e.target.result);
          document.getElementById("editor").innerHTML = doc.content;
          document.getElementById("editor").style.fontFamily = doc.meta.font;
          document.getElementById("editor").style.fontSize = doc.meta.size;
          document.getElementById("editor").style.color = doc.meta.color;
        } catch (err) {
          alert("Fehler beim Laden der .minidoc-Datei.");
        }
      };
      reader.readAsText(file);
    }

    function importOctxt(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result.split("\n").slice(2).join("\n"); // Branding entfernen
        document.getElementById("editor").innerText = text;
      };
      reader.readAsText(file);
    }

    async function checkSpelling() {
      const text = document.getElementById("editor").innerText;
      const response = await fetch("https://api.languagetoolplus.com/v2/check", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({
          text: text,
          language: "de-DE"
        })
      });
      const result = await response.json();
      if (result.matches.length === 0) {
        alert("Keine Fehler gefunden 🎉");
      } else {
        let fehler = result.matches.map(m => `• ${m.message} (${m.replacements.join(", ")})`).join("\n");
        alert(`Rechtschreibfehler gefunden:\n${fehler}`);
      }
    }

    // Initialisierung
    showTab("datei");
  </script>

</body>
</html>
