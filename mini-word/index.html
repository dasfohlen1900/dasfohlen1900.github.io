<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini-Word 2.0 ‚Äî Fixed + Fonts</title>

<link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;600&family=Roboto&family=Open+Sans&family=Lato&family=Montserrat&family=Poppins&family=Ubuntu&family=Fira+Sans&family=Signika&family=Permanent+Marker&family=Patrick+Hand&family=Indie+Flower&family=Caveat&family=Shadows+Into+Light&family=Bungee&family=Coming+Soon&family=Lilita+One&family=Merriweather&family=Playfair+Display&family=Crimson+Text&family=Libre+Baskerville&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#eef4fb;
  --paper:#fff;
  --muted:#6b7280;
  --accent:#0f172a;
  --panel:#f8fafc;
}
html,body{height:100%;margin:0;font-family:Work Sans,Roboto,Open Sans,system-ui,Segoe UI,Arial}
body{background:linear-gradient(180deg,var(--bg),#fff);display:flex;flex-direction:column;align-items:center;padding:18px 12px;box-sizing:border-box}
header{width:100%;max-width:980px;display:flex;align-items:center;gap:8px;padding:10px;border-radius:12px;background:var(--paper);box-shadow:0 6px 24px rgba(16,24,40,0.06);margin-bottom:12px;flex-wrap:wrap}
.brand{display:flex;align-items:center;gap:10px;font-weight:600;color:var(--accent)}
.toolbar{display:flex;gap:6px;flex-wrap:wrap;align-items:center;flex:1}
.btn, .select, .color{
  background:var(--panel);border:1px solid #e6eef7;padding:8px 10px;border-radius:8px;cursor:pointer;font-size:14px
}
.btn:active{transform:translateY(1px)}
.select{appearance:none}
input[type="color"].color{padding:4px;height:36px;width:42px;border-radius:8px}
.canvas{width:100%;max-width:980px;display:flex;justify-content:center}
.paper{
  width:800px;min-width:600px;background:var(--paper);box-shadow:0 8px 24px rgba(16,24,40,0.08);
  border-radius:10px;padding:18px 22px;box-sizing:border-box;min-height:560px;overflow:auto;
  border:1px solid rgba(15,23,42,0.04);
}
#title{font-size:18px;border:0;outline:none;margin:0 0 6px 0;padding:6px 0;font-weight:600}
#editor{min-height:420px;outline:none;padding:10px;border-radius:6px;background:linear-gradient(180deg,#fff,#fbfdff)}
#editor img{max-width:100%;height:auto;display:block;margin:8px 0}
footer{width:100%;max-width:980px;margin-top:10px;display:flex;justify-content:space-between;align-items:center;font-size:13px;color:var(--muted)}
.status{color:var(--muted)}
.counter{font-weight:600;color:var(--accent)}
@media (max-width:760px){
  .paper{width:100%;min-width:auto}
  header{padding:8px}
}
</style>
</head>
<body>
<header>
  <div class="brand">üìù Mini-Word 2.0</div>
  <div class="toolbar" role="toolbar" aria-label="Hauptwerkzeuge">
    <button class="btn" onclick="exec('bold')"><b>B</b></button>
    <button class="btn" onclick="exec('italic')"><i>I</i></button>
    <button class="btn" onclick="exec('underline')"><u>U</u></button>
    <button class="btn" onclick="formatBlock('H1')">H1</button>
    <button class="btn" onclick="exec('insertUnorderedList')">‚Ä¢ Liste</button>
    <button class="btn" onclick="exec('insertOrderedList')">1. Liste</button>
    <button class="btn" onclick="exec('justifyLeft')">‚Øá</button>
    <button class="btn" onclick="exec('justifyCenter')">‚â°</button>
    <button class="btn" onclick="exec('justifyRight')">‚Øà</button>
    <button class="btn" onclick="exec('justifyFull')">‚Øå</button>
    <button class="btn" onclick="exec('undo')">‚Ü∫</button>
    <button class="btn" onclick="exec('redo')">‚Üª</button>

    <select class="select" id="fontFamily" onchange="exec('fontName', this.value)">
      <option value="Arial">Arial</option>
      <option value="Courier">Courier</option>
      <option value="Segoe UI">Segoe UI</option>
      <option value="Verdana">Verdana</option>    
      <option value="Georgia">Georgia</option>
      <option value="Work Sans">Work Sans</option>
      <option value="Roboto">Roboto</option>
      <option value="Open Sans">Open Sans</option>
      <option value="Lato">Lato</option>
      <option value="Montserrat">Montserrat</option>
      <option value="Poppins">Poppins</option>
      <option value="Ubuntu">Ubuntu</option>
      <option value="Fira Sans">Fira Sans</option>
      <option value="Signika">Signika</option>
      <option value="Permanent Marker">Permanent Marker</option>
      <option value="Patrick Hand">Patrick Hand</option>
      <option value="Indie Flower">Indie Flower</option>
      <option value="Caveat">Caveat</option>
      <option value="Shadows Into Light">Shadows Into Light</option>
      <option value="Bungee">Bungee</option>
      <option value="Coming Soon">Coming Soon</option>
      <option value="Lilita One">Lilita One</option>
      <option value="Georgia">Georgia</option>
      <option value="Times New Roman">Times New Roman</option>
      <option value="Courier New">Courier New</option>
      <option value="Merriweather">Merriweather</option>
      <option value="Playfair Display">Playfair Display</option>
      <option value="Crimson Text">Crimson Text</option>
      <option value="Libre Baskerville">Libre Baskerville</option>
    </select>

    <select class="select" id="fontSize" onchange="setFontSize(this.value)">
      <option value="3">14px</option>
      <option value="4" selected>16px</option>
      <option value="5">18px</option>
      <option value="6">20px</option>
      <option value="7">24px</option>
    </select>

    <input class="color" type="color" onchange="exec('foreColor', this.value)">
    <input class="color" type="color" onchange="exec('hiliteColor', this.value)">
    <button class="btn" onclick="addLink()">üîó</button>
    <button class="btn" onclick="exec('unlink')">‚úñ</button>

    <input id="imgFile" type="file" accept="image/*" style="display:none" onchange="insertImage(this.files)">
    <button class="btn" onclick="document.getElementById('imgFile').click()">üñºÔ∏è</button>

    <button class="btn" onclick="printDoc()">üñ® Drucken</button>
    <button class="btn" onclick="downloadOctxt()">üíæ .octxt</button>
    <button class="btn" onclick="downloadHTML()">HTML</button>
    <button class="btn" onclick="downloadText()">TXT</button>

    <input id="openFile" type="file" accept=".octxt,.html,.txt" style="display:none">
    <button class="btn" onclick="document.getElementById('openFile').click()">üìÇ √ñffnen</button>
  </div>
</header>

<div class="canvas">
  <article class="paper">
    <input id="title" value="Neues Dokument" />
    <div id="editor" contenteditable="true" spellcheck="true">
      <p>Willkommen zu Mini-Word 2.0 ‚Äî schreibe los.</p>
    </div>
  </article>
</div>

<footer>
  <div class="status" id="status">Bereit</div>
  <div>W√∂rter: <span id="wordCount" class="counter">0</span> ‚Äî Zeichen: <span id="charCount" class="counter">0</span></div>
</footer>

<script>
const editor = document.getElementById('editor');
const status = document.getElementById('status');
const titleInput = document.getElementById('title');
const openFileInput = document.getElementById('openFile');
const LS_KEY = 'miniword2_octxt_v2';
const LS_TITLE = 'miniword2_title_v2';
let saveTimer = null;

function updateCounts(){
  const text = editor.innerText || '';
  const words = text.trim() ? text.trim().split(/\s+/).length : 0;
  const chars = text.replace(/\n/g,'').length;
  document.getElementById('wordCount').textContent = words;
  document.getElementById('charCount').textContent = chars;
}
editor.addEventListener('input', () => {
  status.textContent = 'Speichern...';
  updateCounts();
  clearTimeout(saveTimer);
  saveTimer = setTimeout(() => {
    localStorage.setItem(LS_KEY, editor.innerHTML);
    localStorage.setItem(LS_TITLE, titleInput.value || 'Neues Dokument');
    status.textContent = 'Alle √Ñnderungen gespeichert';
  }, 700);
});
titleInput.addEventListener('input', ()=> {
  localStorage.setItem(LS_TITLE, titleInput.value || 'Neues Dokument');
});

function exec(cmd,val=null){document.execCommand('styleWithCSS', false, true);document.execCommand(cmd,false,val);editor.focus();}
function formatBlock(tag){document.execCommand('formatBlock',false,tag);editor.focus();}
function setFontSize(size){
  document.execCommand('fontSize', false, size);
  const fonts = editor.querySelectorAll('font[size]');
  fonts.forEach(f => {
    const map={'1':'10px','2':'12px','3':'14px','4':'16px','5':'18px','6':'20px','7':'24px'};
    const px = map[size] || '14px';
    const span = document.createElement('span');
    span.style.fontSize = px;
    span.innerHTML = f.innerHTML;
    f.replaceWith(span);
  });
  editor.focus();
}
function addLink(){const url=prompt('Link-Adresse (inkl. https://) eingeben:');if(url) exec('createLink', url);}
function printDoc(){const w=window.open('','_blank');const css='<style>body{font-family:Work Sans,Arial,Georgia;margin:40px;} img{max-width:100%;}</style>';w.document.write('<html><head><meta charset="utf-8"><title>'+ (titleInput.value||'Dokument') +'</title>'+css+'</head><body>'+editor.innerHTML+'</body></html>');w.document.close();w.focus();setTimeout(()=>{w.print();},300);}
function downloadOctxt(){const name=(titleInput.value||'dokument').replace(/\s+/g,'_')+'.octxt';const blob=new Blob([editor.innerHTML],{type:'text/plain;charset=utf-8'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=name;a.click();setTimeout(()=>URL.revokeObjectURL(a.href),2000);}
function downloadHTML(){const name=(titleInput.value||'dokument').replace(/\s+/g,'_')+'.html';const html='<!doctype html><html><head><meta charset="utf-8"><title>'+ (titleInput.value||'Dokument') +'</title></head><body>'+editor.innerHTML+'</body></html>';const blob=new Blob([html],{type:'text/html'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=name;a.click();setTimeout(()=>URL.revokeObjectURL(a.href),2000);}
function downloadText(){const name=(titleInput.value||'dokument').replace(/\s+/g,'_')+'.txt';const text=editor.innerText||'';const blob=new Blob([text],{type:'text/plain;charset=utf-8'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=name;a.click();setTimeout(()=>URL.revokeObjectURL(a.href),2000);}

/* --- Import inkl. Editor leeren --- */
openFileInput.addEventListener('change',(e)=>{
  const f=e.target.files[0];
  if(!f)return;
  const reader=new FileReader();
  reader.onload=()=>{
    const name=f.name.toLowerCase();
    editor.innerHTML=''; // Alles l√∂schen vor Einf√ºgen
    if(name.endsWith('.octxt')||name.endsWith('.txt')){
      localStorage.removeItem(LS_KEY);
      editor.innerHTML=reader.result.trim();
    } else if(name.endsWith('.html')||name.endsWith('.htm')){
      const parser=new DOMParser();
      const doc=parser.parseFromString(reader.result,'text/html');
      editor.innerHTML=doc.body.innerHTML||reader.result.trim();
    } else {
      alert('Ununterst√ºtztes Format');
    }
    status.textContent='Datei geladen';
    updateCounts();
    localStorage.setItem(LS_KEY, editor.innerHTML);
  };
  reader.readAsText(f,'UTF-8');
  openFileInput.value='';
});

/* --- Bilder einf√ºgen --- */
function insertImage(files){
  if(!files||!files[0])return;
  const file=files[0];
  if(!file.type.startsWith('image/')) return alert('Keine Bilddatei');
  const reader=new FileReader();
  reader.onload=()=>{
    const img=document.createElement('img');
    img.src=reader.result; img.alt=file.name;
    insertNodeAtCaret(img);
    updateCounts();
  };
  reader.readAsDataURL(file);
}
function insertNodeAtCaret(node){
  const sel=window.getSelection();
  if(!sel||sel.rangeCount===0){editor.appendChild(node);return;}
  const range=sel.getRangeAt(0);
  range.deleteContents();
  range.insertNode(node);
  range.setStartAfter(node);
  range.setEndAfter(node);
  sel.removeAllRanges();
  sel.addRange(range);
  editor.focus();
}
editor.addEventListener('dragover',(e)=>{e.preventDefault();editor.style.outline='2px dashed #cfe9ff';});
editor.addEventListener('dragleave',()=>{editor.style.outline='none';});
editor.addEventListener('drop',(e)=>{e.preventDefault();editor.style.outline='none';const files=Array.from(e.dataTransfer.files||[]);const imgs=files.filter(f=>f.type&&f.type.startsWith('image/'));if(imgs.length) insertImage(imgs);});

updateCounts();
document.addEventListener('keydown',(e)=>{
  const mac=navigator.platform.toUpperCase().indexOf('MAC')>=0;
  if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='s'){e.preventDefault();downloadOctxt();status.textContent='Manuell gespeichert';}
  if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='b'){e.preventDefault();exec('bold');}
  if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='i'){e.preventDefault();exec('italic');}
  if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='u'){e.preventDefault();exec('underline');}
});

window.exec=exec;
window.formatBlock=formatBlock;
window.setFontSize=setFontSize;
window.insertImage=function(files){insertImage(files);};
window.addLink=addLink;
window.printDoc=printDoc;
window.downloadOctxt=downloadOctxt;
window.downloadHTML=downloadHTML;
window.downloadText=downloadText;
window.openFile=function(files){openFileInput.files=files;openFileInput.dispatchEvent(new Event('change'));};
window.addEventListener('load',()=>{editor.setAttribute('tabindex','0');});
window.addEventListener('beforeunload',()=>{localStorage.setItem(LS_KEY,editor.innerHTML);localStorage.setItem(LS_TITLE,titleInput.value||'Neues Dokument');});
</script>
</body>
</html>
